#!/usr/bin/env bash
# Create an executable file with best practices.
# Cf. https://codeberg.org/EvanHahn/dotfiles/src/commit/843b9ee13d949d346a4a73ccee2a99351aed285b/home/bin/bin/mksh
# Cf. https://sharats.me/posts/shell-script-best-practices/

set -euo pipefail

usage() {
    echo "Usage: $(basename "$0") FILENAME" >&2
}

main() {
    if [[ $# -lt 1 ]]; then
        usage
        exit 1
    fi

    if [[ $# -gt 1 ]]; then
        echo "Too many arguments provided." >&2
        usage
        exit 1
    fi

    if [[ -f "$1" ]]; then
        echo "File exists: \"$1\"" >&2
        exit 1
    fi

    # shellcheck disable=SC2016
    local template='
    #!/usr/bin/env bash

    set -euo pipefail
    [[ ${TRACE:-0} -eq 1 ]] && set -x

    cd "$(dirname "$0")"

    usage() {
        echo "Usage: $(basename "$0")" >&2
    }

    main() {
    }

    main "$@"'

    echo "$template" | sed -E 's/^[[:space:]]*//' | tail -n +2 > "$1"
    chmod +x "$1"
}

main "$@"
